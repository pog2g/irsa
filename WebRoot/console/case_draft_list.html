<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="res/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="res/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="res/ionicons/css/ionicons.min.css">
        <!-- iCheck for checkboxes and radio inputs -->
        <link rel="stylesheet" href="res/plugins/iCheck/all.css">
        <!-- Select2 -->
        <link rel="stylesheet" href="res/plugins/select2/select2.min.css">
        <!-- switch -->
        <link rel="stylesheet" href="res/plugins/switch/bootstrap-switch.min.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="res/dist/css/AdminLTE.min.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="res/dist/css/skins/_all-skins.min.css">
        <!-- 自定义 -->
        <link rel="shortcut icon" href="self/img/logo.png">
        <link rel="stylesheet" href="self/css/self.css">
        <link rel="stylesheet" href="self/css/add.css">
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    </head>

    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            <header class="main-header"></header>
            <aside class="main-sidebar">
                <section class="sidebar">
                    <ul class="sidebar-menu" id="ul_menu"></ul>
                </section>
            </aside>
            <div class="content-wrapper">
                <section class="content-header">
                    <h1><span id="page_parent_title"></span> <small id="page_title"></small></h1>
                </section>
                <section class="content">
                    <div class="box box-solid">
                        <div class="box-body">
                            <button class="btn btn-primary btn-skin" id="btn_refresh"><i class="fa fa-refresh"></i> 刷新</button>
                        </div>
                    </div>
                    <div class="box box-solid">
                        <div class="box-header with-border">
                            <div class="btn-group">
                                <button class="btn btn-default btn-sm page-info" id="btn_home_page">首页</button>
                                <button class="btn btn-default btn-sm page-info" id="btn_upper_page">上一页</button>
                                <button class="btn btn-default btn-sm" id="btn_page_total" disabled="disabled">0/0</button>
                                <button class="btn btn-default btn-sm" id="btn_data_total" disabled="disabled">总数：0</button>
                                <button class="btn btn-default btn-sm page-info" id="btn_next_page">下一页</button>
                                <button class="btn btn-default btn-sm page-info" id="btn_last_page">末页</button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered" id="table_data">
                                <tr>
                                    <th>年号</th>
                                    <th>编号</th>
                                    <th>类型</th>
                                    <th>申请人</th>
                                    <th>建议追加第三人</th>
                                    <th>第三人</th>
                                    <th>被申请人</th>
                                    <th>行政管理类别</th>
                                    <th>案由</th>
                                    <th>申请时间</th>
                                    <th>状态</th>
                                    <th>添加时间</th>
                                    <th>操作</th>
                                </tr>
                            </table>
                        </div>
                        <div class="overlay" id="table_loading" style="display: none;">
                            <i class="fa fa-spin fa-refresh"></i>
                        </div>
                    </div>
                </section>
            </div>
            <footer class="main-footer"></footer>

            <aside class="control-sidebar control-sidebar-dark">
                <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
                    <li class="active">
                        <a href="#tab_skin" data-toggle="tab"><i class="fa fa-dashboard"></i></a>
                    </li>
                    <li>
                        <a href="#tab_contactbook" data-toggle="tab"><i class="fa fa-user-plus"></i></a>
                    </li>
                    <li>
                        <a href="#tab_notice" data-toggle="tab"><i class="fa fa-bullhorn"></i></a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="tab_skin">
                        <h4 class="control-sidebar-heading">皮肤</h4>
                    </div>
                    <div class="tab-pane" id="tab_contactbook">
                        <h4 class="control-sidebar-heading">通讯录</h4>
                        <ul class="control-sidebar-menu">
                            <li style="display: none;">
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-user bg-gray"></i>
                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">张三</h4>
                                        <p>18712345678</p>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="tab-pane" id="tab_notice">
                        <h4 class="control-sidebar-heading">版本更新公告</h4>
                        <div class="form-group" style="display: none;">
                            <label class="control-sidebar-subheading"><i class="fa fa-check-square-o"></i> 修复挺里面可能会遇到的多处bug</label>
                        </div>
                    </div>
                </div>
            </aside>
            <div class="control-sidebar-bg"></div>
        </div>

        <div class="modal fade" id="modal_msg">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <h4 id="font_msg" style="font-weight: bold;color: red;">错误信息</h4>
                    </div>
                </div>
            </div>
        </div>

        <!-- jQuery 2.1.4 -->
        <script src="res/plugins/jQuery/jQuery-2.1.4.min.js"></script>
        <!-- jQuery UI 1.11.4 -->
        <script src="res/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
        <!-- Bootstrap 3.3.5 -->
        <script src="res/bootstrap/js/bootstrap.min.js"></script>
        <!-- iCheck 1.0.1 -->
        <script src="res/plugins/iCheck/icheck.min.js"></script>
        <!-- Select2 -->
        <script src="res/plugins/select2/select2.full.min.js"></script>
        <!-- switch -->
        <script src="res/plugins/switch/bootstrap-switch.min.js"></script>
        <!-- AdminLTE App -->
        <script src="res/dist/js/app.min.js"></script>
        <!-- 自定义 -->
        <script src="self/js/head.js"></script>
        <script src="self/js/self.js"></script>
        <script src="self/js/sidebar.js"></script>
        <script>
            $(function() {
                var web = getParameter("web");
                initAccount(web);

                var mode = getParameter("mode");
                if(mode == null || mode == "") {
                    mode = 1;
                }
                if(mode == "1") {
                    document.title = "临时存档";
                    $("#page_parent_title").html("录入系统");
                    $("#page_title").html("临时存档");
                }
                if(mode == "2") {
                    document.title = "受理草稿";
                    $("#page_parent_title").html("受理系统");
                    $("#page_title").html("受理草稿");
                }
                if(mode == "3") {
                    document.title = "审理草稿";
                    $("#page_parent_title").html("审理系统");
                    $("#page_title").html("审理草稿");
                }

                var page = 1; //当前页
                var pageTotal = 1; //总页数

                initData();
                //加载数据
                function initData() {
                    $("#table_loading").show();
                    $.ajax({
                        type: "POST",
                        url: "cases/get_draft_list",
                        dataType: "JSON",
                        data: {
                            mode: mode,
                            page: page,
                        },
                        success: function(data) {
                            $("#table_loading").hide();
                            if(data.result != 1) {
                                showMsg(data.error_msg);
                                return;
                            }

                            $(".tr-data").remove(); //清除数据
                            var dataTotal = data.data.data_total;
                            if(dataTotal == 0) {
                                $(".page-info").attr("disabled", true);
                                return;
                            }

                            pageTotal = data.data.page_total;
                            $("#btn_page_total").html(page + "/" + pageTotal);
                            $("#btn_data_total").html("总数：" + dataTotal);
                            $.each(data.data.data_list, function(index, value) {
                                var btn = "";
                                if(mode == "1") {
                                    btn = "<button class='btn btn-xs btn-skin " + btnSkin + " btn-input' data-id='" + value.id + "'><i class='fa fa-edit'></i> 信息录入</button> ";
                                } else {
                                    btn = "<button class='btn btn-xs btn-skin " + btnSkin + " btn-process' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'><i class='fa fa-gavel'></i> 处理</button> ";
                                }

                                $td_data = $("<tr class='tr-data'>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.year_no + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.no + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.label_type + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.apply + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.apply_third_party + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.third_party + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.defendant + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.label_administrative_category + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.label_reason + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.apply_time + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + getStateLabel(value.state == "9" ? "12" : value.state) + "</td>" +
                                    "<td class='td-data' style='cursor: pointer;' data-id='" + value.id + "' data-casesid='" + value.cases_id + "' data-state='" + value.state + "'>" + value.create_time + "</td>" +
                                    "<td>" +
                                    "<button class='btn btn-xs btn-skin " + btnSkin + " btn-delete' data-id='" + value.id + "'><i class='fa fa-trash'></i> 删除</button></td>" +
                                    "</tr>");
                                $("#table_data").append($td_data);
                            });

                            if(page == 1) {
                                if(page == pageTotal) {
                                    $(".page-info").attr("disabled", true);
                                } else {
                                    $("#btn_home_page").attr("disabled", true); //首页
                                    $("#btn_upper_page").attr("disabled", true); //上一页

                                    $("#btn_next_page").attr("disabled", false); //下一页
                                    $("#btn_last_page").attr("disabled", false); //末页
                                }
                            } else {
                                if(page == pageTotal) {
                                    $("#btn_home_page").attr("disabled", false); //首页
                                    $("#btn_upper_page").attr("disabled", false); //上一页

                                    $("#btn_next_page").attr("disabled", true); //下一页
                                    $("#btn_last_page").attr("disabled", true); //末页
                                } else {
                                    $(".page-info").attr("disabled", false);
                                }
                            }

                            onEvent();
                        },
                        error: function(xhr, type) {
                            $("#table_loading").hide();
                            showMsg("系统繁忙");
                        }
                    });
                }

                //首页
                $("#btn_home_page").click(function() {
                    page = 1;
                    initData();
                })
                //上一页
                $("#btn_upper_page").click(function() {
                    page--;
                    initData();
                })
                //下一页
                $("#btn_next_page").click(function() {
                    page++;
                    initData();
                })
                //末页
                $("#btn_last_page").click(function() {
                    page = pageTotal;
                    initData();
                })

                //刷新
                $("#btn_refresh").click(function() {
                    initData();
                })

                //查询
                $("#btn_search").click(function() {
                    initData();
                })

                function onEvent() {
                    $(".td-data").off().on("click", function() {
                        var id = $(this).data("id");
                        var casesId = $(this).data("casesid");
                        var state = $(this).data("state");
                        $.ajax({
                            type: "POST",
                            url: "cases/exist_draft",
                            dataType: "JSON",
                            data: {
                                id: id,
                                mode: mode,
                            },
                            success: function(data) {
                                if(data.result != 1) {
                                    showMsg(data.error_msg);
                                    return;
                                }
                                if(mode == "1") {
                                    window.location.href = "case_add.html?cases=" + id;
                                } else {
                                    window.location.href = "case_process.html?web=" + web + "&cases=" + casesId + "&state=" + state + "&refine=1";
                                }
                            },
                            error: function(xhr, type) {
                                showMsg("系统繁忙");
                            }
                        });
                    })

                    $(".btn-delete").on("click", function() {
                        $.ajax({
                            type: "POST",
                            url: "cases/delete_draft",
                            dataType: "JSON",
                            data: {
                                id: $(this).data("id"),
                                mode: mode,
                            },
                            success: function(data) {
                                if(data.result != 1) {
                                    showMsg(data.error_msg);
                                    return;
                                }
                                initData();
                            },
                            error: function(xhr, type) {
                                showMsg("系统繁忙");
                            }
                        });
                    })
                }
            })
        </script>
    </body>

</html>